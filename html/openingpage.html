<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<title>SmartUI Opening Page</title>
	<!-- âœ… External stylesheet. Make changes to the fonts and style for project in that file -->
<link rel="stylesheet" href="../styles/styles.css" />
<style>
    body {
      margin: 0;
      padding: 0;
    }
    #wrapper {
      position: relative;
      width: 1920px;
      height: 1215px;
      background: url('../images/openingpage.png') no-repeat top left;
      background-size: cover;
    }
 
    .link-area {
      position: absolute;
      width: 100px;
      height: 20px;
      cursor: pointer;
    }
  </style>
</head>
<body>
<div id="wrapper">
<!-- Left side fields from core-input-fields.html inject here -->
	
<!-- Top Bar Link Areas -->
<a class="link-area" href="openingpage.html" style="top: 69px; left: 524px; height:18px; width:130px"></a>
<a class="link-area" href="BSRinformation.html" style="top: 69px; left: 660px; height:18px; width:100px"></a>
<a class="link-area" href="meterreads.html" style="top: 69px; left: 766px; height:18px; width:146px"></a>
<a class="link-area" href="prepaymentsettings.html" style="top: 69px; left: 918px; height:18px; width:125px"></a>
<a class="link-area" href="prepaymentpayments.html" style="top: 69px; left: 1049px; height:18px; width:133px"></a>
<a class="link-area" href="additionalfunctions.html" style="top: 69px; left: 1189px; height:18px; width:119px"></a>
<a class="link-area" href="diagnostics.html" style="top: 69px; left: 1313px; height:18px; width:76px"></a>
<a class="link-area" href="enhancedprepaymentservice.html" style="top: 69px; left: 1394px; height:18px; width:183px"></a>
</div>
	<script>
  window.addEventListener("DOMContentLoaded", () => {
    fetch("/smartui/fragments/core-input-fields.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("wrapper").insertAdjacentHTML("beforeend", html);
      })
      .then(() => {
        const urlParams = new URLSearchParams(window.location.search);
        const scenario = urlParams.get("scenario");
        let data = null;

        if (scenario) {
          fetch(scenario)
            .then(res => res.json())
            .then(json => {
              data = json;
              localStorage.setItem("smartui_data", JSON.stringify(data));
              populateFields(data);
            })
            .catch(err => console.error("Failed to fetch scenario:", err));
        } else {
          const stored = localStorage.getItem("smartui_data");
          if (stored) {
            data = JSON.parse(stored);
            populateFields(data);
          }
        }
      });

    function populateFields(data) {
      const fields = [
        'contract_Account', 'contract',
        'contract_Start', 'operating_Mode', 'payment_Plan', 'read_Retrieval',
        'last_Comm', 'pod', 'device_Guid', 'meter_Serial', 'device_Start',
        'device_End', 'device_Status', 'elecOrGas', 'BPID'
      ];

      fields.forEach(id => {
        const el = document.getElementById(id);
        if (el && data[id] !== undefined) {
          el.value = data[id];
        }

        const duplicates = document.querySelectorAll(`[data-field="${id}"]`);
        duplicates.forEach(dup => {
          dup.value = data[id];
        });
      });

      const fullNameEl = document.getElementById("full_Name");
      if (fullNameEl && data.first_Name && data.last_Name) {
        fullNameEl.value = `${data.first_Name} ${data.last_Name}`;
      }

      const addressEl = document.getElementById("full_address");
      if (addressEl) {
        const parts = [];
        if (data.flatnumber) parts.push(`FLAT ${data.flatnumber.toUpperCase()}`);
        if (data.housenumber && data.street) {
          parts.push(`${data.housenumber.toUpperCase()} ${data.street.toUpperCase()}`);
        } else if (data.housenumber) {
          parts.push(data.housenumber.toUpperCase());
        } else if (data.street) {
          parts.push(data.street.toUpperCase());
        }
        if (data.city) parts.push(data.city.toUpperCase());
        if (data.postcode) parts.push(data.postcode.toUpperCase());

        addressEl.value = parts.join(', ');
      }
    }
  });
</script>
</body>
</html>
